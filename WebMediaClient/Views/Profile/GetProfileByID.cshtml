@model WebMediaClient.Models.ProfileViewModel

@{
	ViewBag.Title = "GetProfileByID";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>GetProfileByID</h2>

<script type="text/javascript">
	window.addEventListener("load", function () { compareUsername() }, false);

	function getToken() {
		if (Modernizr.localstorage) {
			var localProfile = window.localStorage;
			var token = JSON.parse(localProfile.getItem("MediaToken"));
			return token;
		}
	}

	function compareUsername() {
		var currentUsername = '@ViewBag.User.Username';
		var profileUsername = '@Model.Username';
		if (currentUsername == profileUsername)
			$('#add_friend').prop('disabled', true);
	}

	function getFriendID(username) {
		var link = '@Url.Action("GetUserByUsername", "User", new { Username = "oooo" })';
		link = link.replace("oooo", username);
		$.ajax
		({
			url: link,
			dataType: 'json',
			type: 'GET',
			success: function (data) {
				var id = data.ID;
				addFriend(id);
			}
		})
	}

	function addFriend(id) {
		var link = '@Html.Raw(@Url.Action("AddFriend", "Profile", new { UserID = @ViewBag.User.ID, FriendID = -1 }))';
		link = link.replace("-1", id);
		$.ajax
		({
			url: link,
			type: 'POST',
			success: function (data) {
				//var button = document.getElementById('button' + text2);
				//if(data.Response == "OK")
				//	button.value = "Request sent";
			}
		})
	}
</script>

<div class="row">
	<div class="col-md-8">
		<section id="profile_form">
			@using (Html.BeginForm("GetProfileByID", "Profile", new { ID = @ViewBag.ID }, FormMethod.Get, new { @class = "form-horizontal", role = "form" }))
			{
				<h4></h4>
				<hr />
				<div class="form-group">
					@Html.LabelFor(m => m.Username, new { @class = "col-md-2 control-label" })
					<div class="col-md-10">
						@Html.TextBoxFor(m => m.Username, new { @class = "form-control", @enabled = "false" })
					</div>
				</div>
				<div class="form-group">
					@Html.LabelFor(m => m.Name, new { @class = "col-md-2 control-label" })
					<div class="col-md-10">
						@Html.TextBoxFor(m => m.Name, new { @class = "form-control", @enabled = "false" })
					</div>
				</div>
				<div class="form-group">
					@Html.LabelFor(m => m.Age, new { @class = "col-md-2 control-label" })
					<div class="col-md-10">
						@Html.TextBoxFor(m => m.Age, new { @class = "form-control", @enabled = "false" })
					</div>
				</div>
			}
		</section>
	</div>
	<div class="col-md-8">
		@Html.Action("GetTopicForProfile", "Topic", new { profileID = @Model.ID })
	</div>
	<div class="col-md-8">
		<button id="add_friend" class="btn btn-default" onclick="@("getFriendID(" + @Html.Raw(Json.Encode(Model.Username)) + ")")">Add friend</button> 
	</div>
</div>
<div class="row">
	<div class="col-md-8">
		@Html.Action("GetAlbumsForProfile", "Album", new { profileID = @ViewBag.ID })
	</div>
</div>


